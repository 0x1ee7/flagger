(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{290:function(a,t,e){"use strict";e.r(t);var s=e(37),n=Object(s.a)({},function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"alerting"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#alerting","aria-hidden":"true"}},[a._v("#")]),a._v(" Alerting")]),a._v(" "),e("p",[a._v("Flagger can be configured to send alerts to various chat platforms. You can define a global alert provider at\ninstall time or configure alerts on a per canary basis.")]),a._v(" "),e("h2",{attrs:{id:"global-configuration"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#global-configuration","aria-hidden":"true"}},[a._v("#")]),a._v(" Global configuration")]),a._v(" "),e("p",[a._v("Flagger can be configured to send Slack notifications:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("helm upgrade -i flagger flagger/flagger "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--set slack.url"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--set slack.channel"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("general "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--set slack.user"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("flagger\n")])])]),e("p",[a._v("Once configured with a Slack incoming "),e("strong",[a._v("webhook")]),a._v(", Flagger will post messages when a canary deployment\nhas been initialised, when a new revision has been detected and if the canary analysis failed or succeeded.")]),a._v(" "),e("p",[e("img",{attrs:{src:"https://raw.githubusercontent.com/weaveworks/flagger/master/docs/screens/slack-canary-notifications.png",alt:"Slack Notifications"}})]),a._v(" "),e("p",[a._v("A canary deployment will be rolled back if the progress deadline exceeded or if the analysis reached the\nmaximum number of failed checks:")]),a._v(" "),e("p",[e("img",{attrs:{src:"https://raw.githubusercontent.com/weaveworks/flagger/master/docs/screens/slack-canary-failed.png",alt:"Slack Notifications"}})]),a._v(" "),e("p",[a._v("Flagger can be configured to send notifications to Microsoft Teams:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("helm upgrade -i flagger flagger/flagger "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--set msteams.url"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("https://outlook.office.com/webhook/YOUR/TEAMS/WEBHOOK\n")])])]),e("p",[a._v("Similar to Slack, Flagger alerts on canary analysis events:")]),a._v(" "),e("p",[e("img",{attrs:{src:"https://raw.githubusercontent.com/weaveworks/flagger/master/docs/screens/flagger-ms-teams-notifications.png",alt:"MS Teams Notifications"}})]),a._v(" "),e("p",[e("img",{attrs:{src:"https://raw.githubusercontent.com/weaveworks/flagger/master/docs/screens/flagger-ms-teams-failed.png",alt:"MS Teams Notifications"}})]),a._v(" "),e("h2",{attrs:{id:"canary-configuration"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#canary-configuration","aria-hidden":"true"}},[a._v("#")]),a._v(" Canary configuration")]),a._v(" "),e("p",[a._v("Configuring alerting globally has several limitations as it's not possible to specify different channels\nor configure the verbosity on a per canary basis.\nTo make the alerting move flexible, the canary analysis can be extended\nwith a list of alerts that reference an alert provider.\nFor each alert, users can configure the severity level.\nThe alerts section overrides the global setting.")]),a._v(" "),e("p",[a._v("Slack example:")]),a._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" flagger.app/v1beta1\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" AlertProvider\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" on"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("call\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("namespace")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" flagger\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spec")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("type")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" slack\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("channel")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" on"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("call"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("alerts\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("username")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" flagger\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# webhook address (ignored if secretRef is specified)")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("address")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" https"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//hooks.slack.com/services/YOUR/SLACK/WEBHOOK\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# secret containing the webhook address (optional)")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("secretRef")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" on"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("call"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("url\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("---")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" v1\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" Secret\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" on"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("call"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("url\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("namespace")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" flagger\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("data")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("address")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" <encoded"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("url"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")]),a._v("\n")])])]),e("p",[a._v("The alert provider "),e("strong",[a._v("type")]),a._v(" can be: "),e("code",[a._v("slack")]),a._v(", "),e("code",[a._v("msteams")]),a._v(", "),e("code",[a._v("rocket")]),a._v(" or "),e("code",[a._v("discord")]),a._v(". When set to "),e("code",[a._v("discord")]),a._v(",\nFlagger will use "),e("a",{attrs:{href:"https://birdie0.github.io/discord-webhooks-guide/other/slack_formatting.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("Slack formatting"),e("OutboundLink")],1),a._v("\nand will append "),e("code",[a._v("/slack")]),a._v(" to the Discord address.")]),a._v(" "),e("p",[a._v("When not specified, "),e("strong",[a._v("channel")]),a._v(" defaults to "),e("code",[a._v("general")]),a._v(" and "),e("strong",[a._v("username")]),a._v(" defaults to "),e("code",[a._v("flagger")]),a._v(".")]),a._v(" "),e("p",[a._v("When "),e("strong",[a._v("secretRef")]),a._v(" is specified, the Kubernetes secret must contain a data field named "),e("code",[a._v("address")]),a._v(",\nthe address in the secret will take precedence over the "),e("strong",[a._v("address")]),a._v(" field in the provider spec.")]),a._v(" "),e("p",[a._v("The canary analysis can have a list of alerts, each alert referencing an alert provider:")]),a._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[a._v("  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("analysis")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("alerts")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"on-call Slack"')]),a._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("severity")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" error\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("providerRef")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n          "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" on"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("call\n          "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("namespace")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" flagger\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"qa Discord"')]),a._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("severity")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" warn\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("providerRef")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n          "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" qa"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("discord\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"dev MS Teams"')]),a._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("severity")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" info\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("providerRef")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n          "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" dev"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("msteams\n")])])]),e("p",[a._v("Alert fields:")]),a._v(" "),e("ul",[e("li",[e("strong",[a._v("name")]),a._v(" (required)")]),a._v(" "),e("li",[e("strong",[a._v("severity")]),a._v(" levels: "),e("code",[a._v("info")]),a._v(", "),e("code",[a._v("warn")]),a._v(", "),e("code",[a._v("error")]),a._v(" (default info)")]),a._v(" "),e("li",[e("strong",[a._v("providerRef.name")]),a._v(" alert provider name (required)")]),a._v(" "),e("li",[e("strong",[a._v("providerRef.namespace")]),a._v(" alert provider namespace (defaults to the canary namespace)")])]),a._v(" "),e("p",[a._v("When the severity is set to "),e("code",[a._v("warn")]),a._v(", Flagger will alert when waiting on manual confirmation or if the analysis fails.\nWhen the severity is set to "),e("code",[a._v("error")]),a._v(", Flagger will alert only if the canary analysis fails.")]),a._v(" "),e("h2",{attrs:{id:"prometheus-alert-manager"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#prometheus-alert-manager","aria-hidden":"true"}},[a._v("#")]),a._v(" Prometheus Alert Manager")]),a._v(" "),e("p",[a._v("You can use Alertmanager to trigger alerts when a canary deployment failed:")]),a._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[a._v("  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("alert")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" canary_rollback\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("expr")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" flagger_canary_status "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")]),a._v(" 1\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("for")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 1m\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("labels")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("severity")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" warning\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("annotations")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("summary")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Canary failed"')]),a._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("description")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Workload {{ $labels.name }} namespace {{ $labels.namespace }}"')]),a._v("\n")])])])])},[],!1,null,null,null);t.default=n.exports}}]);