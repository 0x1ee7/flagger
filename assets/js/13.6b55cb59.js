(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{274:function(a,e,t){"use strict";t.r(e);var s=t(37),r=Object(s.a)({},function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"flagger-install-on-kubernetes"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#flagger-install-on-kubernetes","aria-hidden":"true"}},[a._v("#")]),a._v(" Flagger Install on Kubernetes")]),a._v(" "),t("p",[a._v("This guide walks you through setting up Flagger on a Kubernetes cluster with Helm v3 or Kustomize.")]),a._v(" "),t("h2",{attrs:{id:"prerequisites"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites","aria-hidden":"true"}},[a._v("#")]),a._v(" Prerequisites")]),a._v(" "),t("p",[a._v("Flagger requires a Kubernetes cluster "),t("strong",[a._v("v1.11")]),a._v(" or newer.")]),a._v(" "),t("h2",{attrs:{id:"install-flagger-with-helm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#install-flagger-with-helm","aria-hidden":"true"}},[a._v("#")]),a._v(" Install Flagger with Helm")]),a._v(" "),t("p",[a._v("Add Flagger Helm repository:")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("helm repo "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" flagger https://flagger.app\n")])])]),t("p",[a._v("Install Flagger's Canary CRD:")]),a._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[a._v("kubectl apply "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("f https"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//raw.githubusercontent.com/weaveworks/flagger/master/artifacts/flagger/crd.yaml\n")])])]),t("p",[a._v("Deploy Flagger for Istio:")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("helm upgrade -i flagger flagger/flagger "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--namespace"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("istio-system "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--set crd.create"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("false "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--set "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("meshProvider")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("istio "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--set "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("metricsServer")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("http://prometheus:9090\n")])])]),t("p",[a._v("Note that Flagger depends on Istio telemetry and Prometheus, if you're installing Istio with istioctl\nthen you should be using the "),t("a",{attrs:{href:"https://istio.io/docs/setup/additional-setup/config-profiles/",target:"_blank",rel:"noopener noreferrer"}},[a._v("default profile"),t("OutboundLink")],1),a._v(".")]),a._v(" "),t("p",[a._v("For Istio multi-cluster shared control plane you can install Flagger\non each remote cluster and set the Istio control plane host cluster kubeconfig:")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("helm upgrade -i flagger flagger/flagger "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--namespace"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("istio-system "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--set crd.create"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("false "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--set "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("meshProvider")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("istio "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--set "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("metricsServer")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("http://istio-cluster-prometheus:9090 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--set istio.kubeconfig.secretName"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("istio-kubeconfig "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--set istio.kubeconfig.key"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("kubeconfig\n")])])]),t("p",[a._v("Note that the Istio kubeconfig must be stored in a Kubernetes secret with a data key named "),t("code",[a._v("kubeconfig")]),a._v(".\nFor more details on how to configure Istio multi-cluster credentials\nread the "),t("a",{attrs:{href:"https://istio.io/docs/setup/install/multicluster/shared-vpn/#credentials",target:"_blank",rel:"noopener noreferrer"}},[a._v("Istio docs"),t("OutboundLink")],1),a._v(".")]),a._v(" "),t("p",[a._v("Deploy Flagger for Linkerd:")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("helm upgrade -i flagger flagger/flagger "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--namespace"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("linkerd "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--set crd.create"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("false "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--set "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("meshProvider")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("linkerd "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--set "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("metricsServer")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("http://linkerd-prometheus:9090\n")])])]),t("p",[a._v("Deploy Flagger for App Mesh:")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("helm upgrade -i flagger flagger/flagger "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--namespace"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("appmesh-system "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--set crd.create"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("false "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--set "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("meshProvider")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("appmesh "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--set "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("metricsServer")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("http://appmesh-prometheus:9090\n")])])]),t("p",[a._v("You can install Flagger in any namespace as long as it can talk to the Prometheus service on port 9090.")]),a._v(" "),t("p",[a._v("For ingress controllers, the install instructions are:")]),a._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://docs.flagger.app/tutorials/contour-progressive-delivery",target:"_blank",rel:"noopener noreferrer"}},[a._v("Contour"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://docs.flagger.app/tutorials/gloo-progressive-delivery",target:"_blank",rel:"noopener noreferrer"}},[a._v("Gloo"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://docs.flagger.app/tutorials/nginx-progressive-delivery",target:"_blank",rel:"noopener noreferrer"}},[a._v("NGINX"),t("OutboundLink")],1)])]),a._v(" "),t("p",[a._v("Enable "),t("strong",[a._v("Slack")]),a._v(" notifications:")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("helm upgrade -i flagger flagger/flagger "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--namespace"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("istio-system "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--set crd.create"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("false "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--set slack.url"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--set slack.channel"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("general "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--set slack.user"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("flagger\n")])])]),t("p",[a._v("Enable "),t("strong",[a._v("Microsoft Teams")]),a._v(" notifications:")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("helm upgrade -i flagger flagger/flagger "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--namespace"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("istio-system "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--set crd.create"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("false "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--set msteams.url"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("https://outlook.office.com/webhook/YOUR/TEAMS/WEBHOOK\n")])])]),t("p",[a._v("You can use the helm template command and apply the generated yaml with kubectl:")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# generate")]),a._v("\nhelm fetch --untar --untardir "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v(" flagger/flagger "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v("\nhelm template flagger ./flagger "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--namespace"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("istio-system "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--set "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("metricsServer")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("http://prometheus.istio-system:9090 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" flagger.yaml\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# apply")]),a._v("\nkubectl apply -f flagger.yaml\n")])])]),t("p",[a._v("To uninstall the Flagger release with Helm run:")]),a._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("helm delete flagger\n")])])]),t("p",[a._v("The command removes all the Kubernetes components associated with the chart and deletes the release.")]),a._v(" "),t("blockquote",[t("p",[t("strong",[a._v("Note")]),a._v(" that on uninstall the Canary CRD will not be removed. Deleting the CRD will make Kubernetes\nremove all the objects owned by Flagger like Istio virtual services, Kubernetes deployments and ClusterIP services.")])]),a._v(" "),t("p",[a._v("If you want to remove all the objects created by Flagger you have delete the Canary CRD with kubectl:")]),a._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("kubectl delete crd canaries.flagger.app\n")])])]),t("h2",{attrs:{id:"install-grafana-with-helm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#install-grafana-with-helm","aria-hidden":"true"}},[a._v("#")]),a._v(" Install Grafana with Helm")]),a._v(" "),t("p",[a._v("Flagger comes with a Grafana dashboard made for monitoring the canary analysis.")]),a._v(" "),t("p",[a._v("Deploy Grafana in the "),t("em",[t("strong",[a._v("istio-system")])]),a._v(" namespace:")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("helm upgrade -i flagger-grafana flagger/grafana "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--namespace"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("istio-system "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--set "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("url")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("http://prometheus.istio-system:9090 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--set "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("user")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("admin "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--set "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("password")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("change-me\n")])])]),t("p",[a._v("Or use helm template command and apply the generated yaml with kubectl:")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# generate")]),a._v("\nhelm fetch --untar --untardir "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v(" flagger/grafana "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v("\nhelm template flagger-grafana ./grafana "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--namespace"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("istio-system "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" flagger-grafana.yaml\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# apply")]),a._v("\nkubectl apply -f flagger-grafana.yaml\n")])])]),t("p",[a._v("You can access Grafana using port forwarding:")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("kubectl -n istio-system port-forward svc/flagger-grafana "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3000")]),a._v(":80\n")])])]),t("h2",{attrs:{id:"install-flagger-with-kustomize"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#install-flagger-with-kustomize","aria-hidden":"true"}},[a._v("#")]),a._v(" Install Flagger with Kustomize")]),a._v(" "),t("p",[a._v("As an alternative to Helm, Flagger can be installed with Kustomize.")]),a._v(" "),t("p",[t("strong",[a._v("Service mesh specific installers")])]),a._v(" "),t("p",[a._v("Install Flagger for Istio:")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("kubectl apply -k github.com/weaveworks/flagger//kustomize/istio\n")])])]),t("p",[a._v("This deploys Flagger in the "),t("code",[a._v("istio-system")]),a._v(" namespace and sets the metrics server URL to Istio's Prometheus instance.")]),a._v(" "),t("p",[a._v("Note that you'll need kubectl 1.14 to run the above the command or you can download\nthe "),t("a",{attrs:{href:"https://github.com/kubernetes-sigs/kustomize/releases",target:"_blank",rel:"noopener noreferrer"}},[a._v("kustomize binary"),t("OutboundLink")],1),a._v(" and run:")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("kustomize build github.com/weaveworks/flagger//kustomize/istio "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" kubectl apply -f -\n")])])]),t("p",[a._v("Install Flagger for AWS App Mesh:")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("kubectl apply -k github.com/weaveworks/flagger//kustomize/appmesh\n")])])]),t("p",[a._v("This deploys Flagger and sets the metrics server URL to App Mesh's Prometheus instance.")]),a._v(" "),t("p",[a._v("Install Flagger for Linkerd:")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("kubectl apply -k github.com/weaveworks/flagger//kustomize/linkerd\n")])])]),t("p",[a._v("This deploys Flagger in the "),t("code",[a._v("linkerd")]),a._v(" namespace and sets the metrics server URL to Linkerd's Prometheus instance.")]),a._v(" "),t("p",[a._v("If you want to install a specific Flagger release, add the version number to the URL:")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("kubectl apply -k github.com/weaveworks/flagger//kustomize/linkerd?ref"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.18")]),a._v(".0\n")])])]),t("p",[t("strong",[a._v("Generic installer")])]),a._v(" "),t("p",[a._v("Install Flagger and Prometheus:")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("kubectl apply -k github.com/weaveworks/flagger//kustomize/kubernetes\n")])])]),t("p",[a._v("This deploys Flagger and Prometheus in the "),t("code",[a._v("flagger-system")]),a._v(" namespace, sets the metrics server URL\nto "),t("code",[a._v("http://flagger-prometheus.flagger-system:9090")]),a._v(" and the mesh provider to "),t("code",[a._v("kubernetes")]),a._v(".")]),a._v(" "),t("p",[a._v("The Prometheus instance has a two hours data retention and is configured to scrape all pods in your cluster\nthat have the "),t("code",[a._v('prometheus.io/scrape: "true"')]),a._v(" annotation.")]),a._v(" "),t("p",[a._v("To target a different provider you can specify it in the canary custom resource:")]),a._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" flagger.app/v1beta1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" Canary\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" app\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("namespace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" test\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# can be: kubernetes, istio, linkerd, appmesh, nginx, gloo")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# use the kubernetes provider for Blue/Green style deployments")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("provider")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx\n")])])]),t("p",[t("strong",[a._v("Customized installer")])]),a._v(" "),t("p",[a._v("Create a kustomization file using flagger as base:")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" kustomization.yaml "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("EOF\nnamespace: istio-system\nbases:\n  - github.com/weaveworks/flagger/kustomize/base/flagger\npatchesStrategicMerge:\n  - patch.yaml\nEOF")]),a._v("\n")])])]),t("p",[a._v("Create a patch and enable Slack notifications by setting the slack channel and hook URL:")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" patch.yaml "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("EOF\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: flagger\nspec:\n  template:\n    spec:\n      containers:\n        - name: flagger\n          args:\n            - -mesh-provider=istio\n            - -metrics-server=http://prometheus.istio-system:9090\n            - -slack-user=flagger\n            - -slack-channel=alerts\n            - -slack-url=https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK\nEOF")]),a._v("\n")])])]),t("p",[a._v("Install Flagger with Slack:")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("kubectl apply -k "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v("\n")])])]),t("p",[a._v("If you want to use MS Teams instead of Slack, replace "),t("code",[a._v("-slack-url")]),a._v(" with "),t("code",[a._v("-msteams-url")]),a._v(" and set the webhook address\nto "),t("code",[a._v("https://outlook.office.com/webhook/YOUR/TEAMS/WEBHOOK")]),a._v(".")])])},[],!1,null,null,null);e.default=r.exports}}]);